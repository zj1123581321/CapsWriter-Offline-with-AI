# å¿«é€Ÿå¼€å§‹ï¼šå¤šè¿›ç¨‹æµ‹è¯•

## ğŸš€ 5åˆ†é’Ÿå¿«é€Ÿæµ‹è¯•

### å‰ç½®æ¡ä»¶

1. âœ… å·²å®‰è£…æ‰€æœ‰ä¾èµ–
2. âœ… æ¨¡å‹æ–‡ä»¶å·²ä¸‹è½½
3. âœ… æµ‹è¯•éŸ³é¢‘æ–‡ä»¶åœ¨ `ref_codes/samples/` ç›®å½•

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæœ€ç®€å•ï¼‰

**Windows ç”¨æˆ·**ï¼š
```bash
# åŒå‡»è¿è¡Œï¼Œæˆ–åœ¨å‘½ä»¤è¡Œæ‰§è¡Œ
tests\multiprocess\start_full_test.bat
```

**Linux/Mac ç”¨æˆ·**ï¼š
```bash
# åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œ
./tests/multiprocess/start_full_test.sh
```

æŒ‰ç…§è„šæœ¬æç¤ºæ“ä½œå³å¯ã€‚

### æ–¹æ³•äºŒï¼šç›´æ¥è¿è¡Œ Python è„šæœ¬

```bash
# è¿è¡Œå®Œæ•´æµ‹è¯•ï¼ˆåŒ…å«åŸºå‡†æµ‹è¯•å’Œå¤šè¿›ç¨‹æµ‹è¯•ï¼‰
python tests/multiprocess/run_test.py

# æˆ–è€…åªè¿è¡Œå¤šè¿›ç¨‹æµ‹è¯•
python tests/multiprocess/run_test.py --mode multiprocess
```

---

### æ–¹æ³•ä¸‰ï¼šæ‰‹åŠ¨æµ‹è¯•ï¼ˆéœ€è¦ 3 ä¸ªç»ˆç«¯ï¼‰

#### Windows ç”¨æˆ·

**ç»ˆç«¯ 1 - Server**
```bash
tests\multiprocess\start_server.bat
```

**ç»ˆç«¯ 2 - èµ„æºç›‘æ§**
```bash
tests\multiprocess\start_monitor.bat
```

**ç»ˆç«¯ 3 - æµ‹è¯•å®¢æˆ·ç«¯**
```bash
tests\multiprocess\start_test_client.bat
```

#### Linux/Mac ç”¨æˆ·

**ç»ˆç«¯ 1 - Server**
```bash
./tests/multiprocess/start_server.sh
```

**ç»ˆç«¯ 2 - èµ„æºç›‘æ§**
```bash
./tests/multiprocess/start_monitor.sh
```

**ç»ˆç«¯ 3 - æµ‹è¯•å®¢æˆ·ç«¯**
```bash
./tests/multiprocess/start_test_client.sh
```

#### æˆ–è€…ç›´æ¥è¿è¡Œ Python è„šæœ¬

**ç»ˆç«¯ 1 - Server**
```bash
python tests/multiprocess/test_core_multiprocess.py
# æˆ–æµ‹è¯•å•è¿›ç¨‹ç‰ˆæœ¬ï¼špython -m capswriter.server.core
```

**ç»ˆç«¯ 2 - èµ„æºç›‘æ§**
```bash
python tests/multiprocess/monitor_resources.py
```

**ç»ˆç«¯ 3 - æµ‹è¯•å®¢æˆ·ç«¯**
```bash
python tests/multiprocess/test_concurrent_client.py
```

---

## ğŸ“Š é¢„æœŸç»“æœ

### å•è¿›ç¨‹ï¼ˆåŸºå‡†ï¼‰

```
æ–‡ä»¶1å¤„ç†: 12.5s
æ–‡ä»¶2å¤„ç†: 11.8s
æ€»è€—æ—¶: 24.3s
å¹¶å‘åŠ é€Ÿæ¯”: 1.00x
å³°å€¼å†…å­˜: ~2000 MB
```

### å¤šè¿›ç¨‹ï¼ˆ2ä¸ªè¿›ç¨‹ï¼‰

```
æ–‡ä»¶1å¤„ç†: 12.3s
æ–‡ä»¶2å¤„ç†: 11.9s
æ€»è€—æ—¶: 13.2s  âš¡ å¿«äº†çº¦ 1.84x
å¹¶å‘åŠ é€Ÿæ¯”: 1.84x
å³°å€¼å†…å­˜: ~3800 MB (å¢é•¿ 1.9x)
```

**å…³é”®æŒ‡æ ‡**ï¼š
- âœ… å¹¶å‘åŠ é€Ÿæ¯”ï¼š1.5x - 2.0x
- âœ… å†…å­˜å¢é•¿æ¯”ï¼š1.8x - 2.2x
- âœ… ä¸¤ä¸ªæ–‡ä»¶åŒæ—¶å¤„ç†

---

## âš ï¸ å¸¸è§é—®é¢˜

### 1. æ‰¾ä¸åˆ°æµ‹è¯•æ–‡ä»¶

```bash
# æ£€æŸ¥æµ‹è¯•æ–‡ä»¶
ls -lh ref_codes/samples/

# åº”è¯¥çœ‹åˆ°ï¼š
# 01.mp3  02.mp3
```

### 2. Server è¿æ¥å¤±è´¥

- ç¡®è®¤ Server å·²å¯åŠ¨
- æ£€æŸ¥ç«¯å£ 6016 æ˜¯å¦è¢«å ç”¨
- ç¡®è®¤é˜²ç«å¢™è®¾ç½®

### 3. å†…å­˜å ç”¨è¿‡é«˜

æ­£å¸¸ç°è±¡ã€‚2ä¸ªè¿›ç¨‹å¤§çº¦éœ€è¦ **3.5-5.5 GB** å†…å­˜ã€‚

å¦‚æœè¶…è¿‡ 6GBï¼Œå¯èƒ½å­˜åœ¨å†…å­˜æ³„æ¼ã€‚

### 4. åŠ é€Ÿæ¯”ä¸æ˜æ˜¾

å¯èƒ½åŸå› ï¼š
- CPU æ ¸å¿ƒæ•°ä¸è¶³ï¼ˆå»ºè®® 8 æ ¸ä»¥ä¸Šï¼‰
- ç£ç›˜ I/O ç“¶é¢ˆ
- æµ‹è¯•æ–‡ä»¶å¤ªå°

---

## ğŸ“ ä¸‹ä¸€æ­¥

æµ‹è¯•é€šè¿‡åï¼Œå¯ä»¥ï¼š

1. **ä¿®æ”¹è¿›ç¨‹æ•°**ï¼šç¼–è¾‘ `test_core_multiprocess.py:22`
   ```python
   worker_processes = 3  # æ”¹ä¸º 3 ä¸ªè¿›ç¨‹
   ```

2. **å‹åŠ›æµ‹è¯•**ï¼šå¢åŠ æ›´å¤šæµ‹è¯•æ–‡ä»¶
3. **é›†æˆåˆ°ä¸»ä»£ç **ï¼šå°†å¤šè¿›ç¨‹é€»è¾‘åˆå¹¶åˆ° `src/capswriter/server/core.py`

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

æŸ¥çœ‹å®Œæ•´æ–‡æ¡£ï¼š`tests/multiprocess/README.md`
